<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Minecraft Real Ping Monitor</title>

<link href="https://fonts.cdnfonts.com/css/minecraft-4" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<style>
body{
  margin:0;
  height:100vh;
  background:url("beaa776788318ffa9adf475282e18bb5.gif") no-repeat center center fixed;
  background-size:cover;
  font-family:'Minecraft', sans-serif;
  display:flex;
  justify-content:center;
  align-items:center;
}
.overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.65);
}
.card{
  position:relative;
  z-index:2;
  width:95%;
  max-width:460px;
  backdrop-filter:blur(16px);
  background:rgba(10,10,20,.8);
  border-radius:22px;
  padding:18px;
  color:#e5e7eb;
  box-shadow:0 0 35px #00ffff88;
}
h1{
  text-align:center;
  color:#00ffff;
  text-shadow:0 0 12px #00ffff;
}
input,select,button{
  width:100%;
  padding:10px;
  margin:6px 0;
  border:none;
  border-radius:10px;
  font-family:inherit;
}
input,select{
  background:#111827;
  color:white;
}
button{
  background:#00ffff;
  color:black;
  font-weight:bold;
}
.good{color:#22c55e}
.medium{color:#facc15}
.bad{color:#ef4444}
.neon{text-shadow:0 0 8px currentColor}
#map{
  height:140px;
  border-radius:12px;
  margin-top:10px;
}
</style>
</head>

<body>
<div class="overlay"></div>

<div class="card">
<h1>Minecraft Ping</h1>

<input id="ipInput" placeholder="Server IP (play.example.net)">
<input id="portInput" placeholder="Port">

<select id="typeSelect" onchange="autoPort()">
  <option value="java">Minecraft Java</option>
  <option value="bedrock">Minecraft Bedrock</option>
  <option value="geyser">Geyser (Java + Bedrock)</option>
  <option value="other">Other Server</option>
</select>

<button onclick="checkPing()">Check Ping</button>

<div style="margin-top:8px;line-height:1.6">
  Ping: <span id="ping">--</span> ms<br>
  Min: <span id="minPing">--</span> ms |
  Max: <span id="maxPing">--</span> ms<br>
  Gameplay: <span id="quality">--</span>
</div>

<canvas id="chart"></canvas>
<div id="map"></div>
</div>

<audio id="pingSound" src="sounds/alert.mp3" preload="auto"></audio>

<script>
/* ELEMENTS */
const ipInput = document.getElementById("ipInput");
const portInput = document.getElementById("portInput");
const typeSelect = document.getElementById("typeSelect");
const pingEl = document.getElementById("ping");
const minEl = document.getElementById("minPing");
const maxEl = document.getElementById("maxPing");
const qualityEl = document.getElementById("quality");
const sound = document.getElementById("pingSound");

let minPing = Infinity;
let maxPing = 0;

/* AUTO PORT */
function autoPort(){
  if(typeSelect.value === "java") portInput.value = 25565;
  else if(typeSelect.value === "bedrock") portInput.value = 19132;
}

/* GRAPH */
const chart = new Chart(document.getElementById("chart"), {
  type:"line",
  data:{
    labels:[],
    datasets:[{
      label:"Ping (ms)",
      data:[],
      borderWidth:2,
      tension:.3
    }]
  },
  options:{responsive:true}
});

/* REAL PING */
async function checkPing(){
  const ip = ipInput.value.trim();
  const port = portInput.value.trim();
  const type = typeSelect.value;

  if(!ip || !port){
    alert("Enter IP and Port");
    return;
  }

  try{
    const res = await fetch(
      `https://YOUR-BACKEND-URL/ping?ip=${ip}&port=${port}&type=${type}`
    );
    const data = await res.json();

    if(!data.online){
      qualityEl.innerText = "SERVER OFFLINE";
      qualityEl.className = "bad neon";
      return;
    }

    const ping = data.ping;
    pingEl.innerText = ping;

    minPing = Math.min(minPing, ping);
    maxPing = Math.max(maxPing, ping);
    minEl.innerText = minPing;
    maxEl.innerText = maxPing;

    if(ping <= 100){
      qualityEl.innerText = "GOOD";
      qualityEl.className = "good neon";
    }else if(ping <= 200){
      qualityEl.innerText = "MEDIUM";
      qualityEl.className = "medium neon";
    }else{
      qualityEl.innerText = "BAD";
      qualityEl.className = "bad neon";
      sound.play();
    }

    chart.data.labels.push("");
    chart.data.datasets[0].data.push(ping);
    chart.update();

  }catch(e){
    alert("Backend not reachable");
  }
}

/* LOCATION MAP */
const map = L.map('map').setView([0,0],2);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

fetch("https://ipapi.co/json/")
.then(r=>r.json())
.then(l=>{
  map.setView([l.latitude,l.longitude],10);
  L.marker([l.latitude,l.longitude]).addTo(map);
});

/* FULLSCREEN ON TAP (mobile) */
document.body.addEventListener("click",()=>{
  if(document.fullscreenElement==null){
    document.body.requestFullscreen().catch(()=>{});
  }
},{once:true});
</script>
</body>
</html>
