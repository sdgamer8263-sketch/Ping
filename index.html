<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Minecraft Ping Tool</title>
<link href="https://fonts.cdnfonts.com/css/minecraft-4" rel="stylesheet">
<style>
*{box-sizing:border-box;font-family:'Minecraft',sans-serif}
body{
  margin:0;min-height:100vh;
  background:
    linear-gradient(rgba(0,0,0,.75),rgba(0,0,0,.75)),
    url("beaa776788318ffa9adf475282e18bb5.gif") center/cover no-repeat fixed;
  display:flex;align-items:center;justify-content:center;color:#0ff
}
.card{
  width:95%;max-width:420px;padding:20px;
  background:rgba(0,0,0,.45);backdrop-filter:blur(16px);
  border-radius:20px;box-shadow:0 0 30px #0ff
}
h1{text-align:center;margin:0 0 10px}
input,select,button{
  width:100%;padding:12px;margin:8px 0;border-radius:10px;border:none
}
input,select{background:#111;color:#0ff}
button{background:#0ff;color:#000;font-weight:bold}
button:active{transform:scale(.97)}
.result{text-align:center;margin-top:6px}
.good{color:#0f0}.medium{color:#ff0}.bad{color:#f33}
canvas{margin-top:10px;width:100%}
.small{text-align:center;font-size:12px;opacity:.8}
</style>
</head>
<body>

<div class="card">
  <h1>MC PING</h1>

  <input id="ip" placeholder="Server IP (play.hypixel.net)">
  <input id="port" value="25565">

  <select id="type">
    <option value="java">Java</option>
    <option value="bedrock">Bedrock</option>
    <option value="geyser">Geyser</option>
    <option value="other">Other</option>
  </select>

  <button onclick="checkPing()">Check Ping</button>

  <div class="result" id="status">Ready</div>
  <div class="result" id="ping"></div>
  <div class="result" id="quality"></div>
  <div class="result" id="minmax"></div>
  <div class="result" id="timeinfo"></div>
  <div class="result" id="location"></div>

  <canvas id="graph" height="80"></canvas>
  <div class="small">Tip: First click may wake server</div>
</div>

<audio id="alertSound" src="sounds/alert.mp3"></audio>

<script>
const API="https://ping-yies.onrender.com/ping";
const c=document.getElementById("graph"),x=c.getContext("2d");
let hist=[],times=[],minPing=null,maxPing=null,waking=false;

function checkPing(){
  const ip=document.getElementById("ip").value.trim();
  const port=document.getElementById("port").value.trim()||"25565";
  const type=document.getElementById("type").value;
  if(!ip){set("Enter server IP ❌");return}

  set("Checking...");
  document.getElementById("ping").innerText="";
  document.getElementById("quality").innerText="";
  
  fetch(`${API}?ip=${ip}&port=${port}&type=${type}`)
    .then(r=>r.json())
    .then(d=>{
      if(!d.online){set("Server Offline ❌");return}
      waking=false;

      const p=d.ping;

      // Min / Max ping
      minPing = minPing===null ? p : Math.min(minPing,p);
      maxPing = maxPing===null ? p : Math.max(maxPing,p);
      document.getElementById("minmax").innerText = `Min: ${minPing} ms | Max: ${maxPing} ms`;

      // Time
      const now=new Date().toLocaleTimeString();
      times.push(now);
      if(times.length>20) times.shift();
      document.getElementById("timeinfo").innerText = `Last check: ${now}`;

      // Current ping
      hist.push(p); if(hist.length>20) hist.shift();
      document.getElementById("ping").innerText=`Ping: ${p} ms`;

      // Quality
      let t="GOOD",cls="good";
      if(p>200){t="BAD";cls="bad";playSound()}
      else if(p>120){t="MEDIUM";cls="medium"}
      document.getElementById("quality").innerHTML=`<span class="${cls}">${t}</span>`;

      // Location
      fetchLocation(ip);

      set("Server Online ✅");
      draw();
    })
    .catch(()=>{if(!waking){waking=true;set("Waking server… tap again ⏳");}});
}

function fetchLocation(ip){
  fetch(`https://ipapi.co/${ip}/country_name/`)
    .then(r=>r.text())
    .then(c=>document.getElementById("location").innerText="Server location: "+c)
    .catch(()=>{document.getElementById("location").innerText=""});
}

function playSound(){const a=document.getElementById("alertSound");a.currentTime=0;a.play()}
function set(s){document.getElementById("status").innerText=s}

function draw(){
  c.width=c.clientWidth;
  x.clearRect(0,0,c.width,c.height);
  x.beginPath();
  x.strokeStyle="#0ff";
  hist.forEach((p,i)=>{
    const xx=i*(c.width/(hist.length-1||1));
    const yy=c.height-(p/300*c.height);
    i?x.lineTo(xx,yy):x.moveTo(xx,yy);
  });
  x.stroke();
}
</script>

</body>
</html>
